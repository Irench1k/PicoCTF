# Solution "Java Code Analysis!?!"
This challenge focuses on **weak secret management in JWT authentication systems**.

## Step 1: Explore the Page
Start by browsing the webpage. You will notice that you are logged in as a regular user and cannot access the "Flag" book because you are not an admin. Familiarize yourself with the webpage layout and functionality.

## Step 2: Explore the Source Code
Inspect the source code to identify potential vulnerabilities. You will find an interesting class, SecretGenerator, that includes the following method:
```java
private String generateRandomString(int len) {
    // not so random
    return "1234";
}
```
This method reveals that the server is using a weak and predictable secret (1234) to sign JWTs.

## What is JWT?
What is a secret and why do we need to bother? A secret is a key used in JSON Web Tokens (JWT) to sign and verify token authenticity. It ensures the token is issued by a trusted source.
The JWT itself consists of three parts:
1. **Header**: Contains metadata such as the signing algorithm and token type.
2. **Payload**: Includes the claims or data (e.g., user ID, roles).
3. **Signature**: Generated by signing the concatenation of the Header and Payload using the secret and the specified algorithm.

An example of a JWT is:
```json
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c
```

The secret itself, however, is not directly visible in the JWT; it is stored securely on the server and is used to:
1. Generate the **Signature** when issuing the token.
2. Validate the token by recalculating the signature during verification.

## Step 3: Locate the JWT in Local Storage
Open your browser's Developer Tools and navigate to the Storage tab. Under Local Storage, you will find the JWT used by the application. Copy the token for further analysis.

Let's see whether our hypothesis is correct: go to jwt.io and paste the copied JWT into the decoder. Use the secret `1234` to verify the signature. This will confirm that the server relies on this weak secret for token authentication.

## Step 4: Modify the Payload
To escalate privileges, modify the JWT payload to set your role as Admin and update the userId and email:
```json
{
  "role": "Admin",
  "iss": "bookshelf",
  "exp": 1738076098,
  "iat": 1737471298,
  "userId": 2,
  "email": "admin"
}
```

Step 5: Update the JWT in the Local Storage
After generating a new JWT with the modified payload and the secret 1234, replace the original token in the Local Storage of your browser:
```json
{"role":"Admin","iss":"bookshelf","exp":1738076098,"iat":1737471298,"userId":2,"email":"admin"}
```

Finally, you can refresh the page and retrieve your flag!

